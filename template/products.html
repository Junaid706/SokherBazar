{% extends "base.html" %}
{% load static %}
{% load custom_tags %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary:#D35400;
    --secondary:#27AE60;
    --accent:#E67E22;
    --light:#FEF5E7;
    --dark:#2C3E50;
    --text:#333333;
    --text-light:#777777;
    --white:#FFFFFF;
    --gray:#f5f5f5;
    --border:#e0e0e0;
}

/* Global */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body{color:var(--text);background-color:var(--white);line-height:1.6;}
.container{width:100%;max-width:1200px;margin:0 auto;padding:0 20px;}

/* Buttons */
.btn{display:inline-block;padding:12px 28px;border-radius:50px;text-decoration:none;font-weight:600;transition:all 0.3s ease;cursor:pointer;border:none;font-size:1rem;}
.btn-primary{background-color:var(--primary);color:var(--white);border:2px solid var(--primary);}
.btn-primary:hover{background-color:transparent;color:var(--primary);}
.btn-secondary{background-color:transparent;color:var(--primary);border:2px solid var(--primary);}
.btn-secondary:hover{background-color:var(--primary);color:var(--white);}

/* Filters & Header */
.products-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:15px;}
.products-title{font-size:1.8rem;color:var(--dark);}
.products-controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.search-bar{padding:10px 15px;border:1px solid var(--border);border-radius:5px;width:220px;}
.sort-select,.filter-select{padding:10px 15px;border:1px solid var(--border);border-radius:5px;background:var(--white);color:var(--text);cursor:pointer;}

/* Product Grid */
.products-section{padding:60px 0;background:var(--white);}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px;}

/* Card Style (Same as Home) */
.product-card{background:var(--white);border-radius:15px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.08);transition:transform 0.3s,box-shadow 0.3s;position:relative;display:flex;flex-direction:column;}
.product-card:hover{transform:translateY(-6px);box-shadow:0 8px 20px rgba(0,0,0,0.12);}
.product-image{width:100%;height:220px;overflow:hidden;position:relative;}
.product-image img{width:100%;height:100%;object-fit:cover;transition:transform 0.4s;}
.product-card:hover .product-image img{transform:scale(1.05);}
.product-wishlist{position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.85);width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--primary);cursor:pointer;transition:all 0.3s;}
.product-wishlist:hover{background:var(--primary);color:white;}
.product-content{padding:18px 15px;flex:1;display:flex;flex-direction:column;justify-content:space-between;}
.product-name{font-size:1.05rem;font-weight:600;color:var(--dark);margin-bottom:8px;}
.product-artisan{font-size:0.85rem;color:var(--text-light);margin-bottom:10px;}
.product-category{font-size:0.8rem;color:var(--secondary);font-weight:500;margin-bottom:5px;}
.product-rating{display:flex;align-items:center;margin-bottom:8px;}
.product-rating i{color:#FFC107;margin-right:3px;}
.rating-count{color:var(--text-light);font-size:0.8rem;}
.product-price{display:flex;align-items:center;justify-content:space-between;margin-top:auto;}
.price{font-size:1.2rem;font-weight:700;color:var(--primary);}
.original-price{text-decoration:line-through;color:var(--text-light);font-size:0.9rem;margin-left:6px;}
.add-to-cart{background:var(--primary);color:white;border:none;width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;}
.add-to-cart:hover{background:var(--accent);transform:scale(1.1);}

@media(max-width:768px){
    .products-header{flex-direction:column;align-items:flex-start;}
    .search-bar{width:100%;}
}
</style>
{% endblock %}

{% block content %}
<section class="products-section">
    <div class="container">
        <form method="get" class="products-header">
            <h2 class="products-title">All Handmade Products</h2>
            <div class="products-controls">
                <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Search products..." class="search-bar">
                <select name="category" class="filter-select">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if request.GET.category|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
                <select name="sort" class="sort-select">
                    <option value="">Sort by: Featured</option>
                    <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
                    <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
                    <option value="newest" {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest</option>
                    <option value="best_rated" {% if request.GET.sort == 'best_rated' %}selected{% endif %}>Best Rated</option>
                </select>
                <button type="submit" class="btn btn-primary">Apply</button>
            </div>
        </form>

        <div class="products-grid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                    {% else %}
                        <img src="{% static 'images/default-product.jpg' %}" alt="{{ product.name }}">
                    {% endif %}
                    {% if product.id in user_wishlist_ids %}
<a href="{% url 'remove_from_wishlist' product.id %}" class="product-wishlist active">
    <i class="fas fa-heart"></i>
</a>
{% else %}
<a href="{% url 'add_to_wishlist' product.id %}" class="product-wishlist">
    <i class="far fa-heart"></i>
</a>
{% endif %}
                </div>

                <div class="product-content">
                    <div class="product-category">{{ product.category.name|default:"Uncategorized" }}</div>
                    <h3 class="product-name">{{ product.name }}</h3>
                    <div class="product-artisan">By: {{ product.artisan.shop_name }}</div>
                    <div class="product-rating">
                        {% for _ in product.star_list.full %}<i class="fas fa-star"></i>{% endfor %}
                        {% for _ in product.star_list.half %}<i class="fas fa-star-half-alt"></i>{% endfor %}
                        {% for _ in product.star_list.empty %}<i class="far fa-star"></i>{% endfor %}
                        <span class="rating-count">({{ product.rating|default:"0" }})</span>
                    </div>
                    <div class="product-price">
                        <div>
                            <span class="price">৳ {{ product.discount_price|default:product.price }}</span>
                            {% if product.discount_price %}
                            <span class="original-price">৳ {{ product.price }}</span>
                            {% endif %}
                        </div>
                        <form action="{% url 'add_to_cart' product.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="add-to-cart"><i class="fas fa-shopping-cart"></i></button>
                        </form>
                    </div>
                </div>
            </div>
            {% empty %}
            <p style="grid-column:1/-1;text-align:center;color:var(--text-light);font-size:1.1rem;">No products found.</p>
            {% endfor %}
        </div>
    </div>
</section>

<script>
document.querySelectorAll('.product-wishlist').forEach(btn=>{
    btn.addEventListener('click',()=>{
        const icon=btn.querySelector('i');
        icon.classList.toggle('fas');
        icon.classList.toggle('far');
        btn.style.background=icon.classList.contains('fas')?'var(--primary)':'rgba(255,255,255,0.85)';
        btn.style.color=icon.classList.contains('fas')?'white':'var(--primary)';
    });
});
</script>
{% endblock %}
